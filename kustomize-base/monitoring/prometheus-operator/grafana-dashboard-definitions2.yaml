apiVersion: v1
kind: ConfigMapList
items:


  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: kubernetes-dns
      namespace: monitoring
    data:
      kubernetes-dns.json: |-
        {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"description":"Dashboard for Kubernetes kube-dns service that uses SkyDNS","editable":true,"gnetId":3152,"graphTooltip":1,"id":59,"iteration":1581606430444,"links":[],"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","fill":1,"gridPos":{"h":9,"w":24,"x":0,"y":0},"id":6,"interval":"30s","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.5, sum(rate(skydns_skydns_dns_request_duration_seconds_bucket[1m])) by (le,system)) * 1000","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"50% {{ system }}","refId":"A"},{"expr":"histogram_quantile(0.95, sum(rate(skydns_skydns_dns_request_duration_seconds_bucket[1m])) by (le,system)) * 1000","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"95% {{ system }}","refId":"B"},{"expr":"histogram_quantile(0.99, sum(rate(skydns_skydns_dns_request_duration_seconds_bucket[1m])) by (le,system)) * 1000","format":"time_series","intervalFactor":1,"legendFormat":"99% {{ system }}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"50% 95% 99% DNS requests MS","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"gridPos":{"h":7,"w":24,"x":0,"y":9},"id":1,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(skydns_skydns_dns_cachemiss_count_total{pod=~\"$pod\"}[5m])","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"{{pod}}","metric":"skydns_skydns_dns_cachemiss_count_total","refId":"A","step":40}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Cachemiss Rate","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"gridPos":{"h":7,"w":24,"x":0,"y":16},"id":2,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(skydns_skydns_dns_error_count_total{pod=~\"$pod\"}[1m])","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}} {{system}}","metric":"skydns_skydns_dns_error_count_total","refId":"A","step":40}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Error Count Rate","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"gridPos":{"h":7,"w":12,"x":0,"y":23},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(skydns_skydns_dns_request_count_total{pod=~\"$pod\"}[1m]) ","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"{{pod}} {{system}}","metric":"skydns_skydns_dns_request_count_total","refId":"A","step":60}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Request","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":1,"gridPos":{"h":7,"w":12,"x":12,"y":23},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(irate(skydns_skydns_dns_request_duration_seconds_sum{pod=~\"$pod\"}[1m])) by (system) * 1000","format":"time_series","interval":"","intervalFactor":2,"legendFormat":"{{system}}","metric":"skydns_skydns_dns_request_duration_seconds_sum","refId":"A","step":60}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Avg Request Duration Milliseconds","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"30s","schemaVersion":18,"style":"dark","tags":["K8s","DNS"],"templating":{"list":[{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"prometheus","definition":"label_values(skydns_skydns_dns_cachemiss_count_total, pod)","hide":0,"includeAll":true,"label":null,"multi":false,"name":"pod","options":[],"query":"label_values(skydns_skydns_dns_cachemiss_count_total, pod)","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-1h","to":"now"},"timepicker":{"collapse":false,"enable":true,"notice":false,"now":true,"refresh_intervals":["30s","1m","5m","15m","30m","1h","2h","1d"],"status":"Stable","time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"],"type":"timepicker"},"timezone":"browser","title":"Kubernetes - DNS","uid":"EKaqSlEZk","version":11}
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: resource-lifecycle-cluster
      namespace: monitoring
    data:
      resource-lifecycle-cluster.json: |-
        {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":17,"iteration":1582021727200,"links":[],"panels":[{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":36,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","description":"Percentage of the actual used CPU summed on all nodes from the same pool","fill":1,"fillGradient":0,"gridPos":{"h":12,"w":24,"x":0,"y":1},"id":38,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"(sum(  label_replace(  rate(container_cpu_usage_seconds_total{container_name!=\"POD\",container_name=~\"^.+\", node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\"}[1m]),\"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\") ) by (nodepool) * 100 ) \n/\n(sum(  label_replace(  kube_node_status_capacity_cpu_cores{},\"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\")) by (nodepool))","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"{{ nodepool }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU Node Pool Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"CPU Node Pool Saturation","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":1},"id":24,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"fillGradient":0,"gridPos":{"h":13,"w":24,"x":0,"y":2},"id":2,"interval":"2m","legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"(sum(rate(container_cpu_usage_seconds_total{container_name!=\"POD\",container_name=~\"^.+\", node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\"}[1m])) by (node) * 100 )  /  (sum(kube_node_status_capacity_cpu_cores{}) by (node))","format":"time_series","hide":false,"interval":"","intervalFactor":1,"legendFormat":"{{node}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Node CPU Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"CPU Nodes Saturation","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":2},"id":26,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"Value is a sum of all containers of the same type running in all nodes. \n\n100% => the containers are using the same amount as stated in\n\"resources:     requests:  cpu: (value)m\". \n\n125%  => Containers overutilization  of 25%\n\n60% => Containers underutilization of 40%","fill":0,"fillGradient":0,"gridPos":{"h":11,"w":24,"x":0,"y":3},"id":18,"interval":"2m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"rightSide":true,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum( label_replace(rate(container_cpu_usage_seconds_total{container_name!=\"POD\",container_name=~\"^.+\", node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\" }[1m]),\n                    \"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\") \n) by (container_name, nodepool)\n   * 100\n/\nsum(  \n  label_replace(     \n        label_replace( kube_pod_container_resource_requests_cpu_cores{node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\"} ,\n                       \"container_name\", \"$1\", \"container\", \"(.*)\"),\n        \"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\")\n) by (container_name, nodepool)","format":"time_series","hide":false,"interval":"5m","intervalFactor":1,"legendFormat":"{{container_name}} --- {{nodepool}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU Container Requested Saturation ON Node Pool","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"CPU Container Requested Saturation ON Node Pool","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":3},"id":28,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"fillGradient":0,"gridPos":{"h":11,"w":24,"x":0,"y":4},"id":4,"interval":"5m","legend":{"alignAsTable":true,"avg":false,"current":false,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"rightSide":true,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(container_cpu_usage_seconds_total{container_name!=\"POD\", container_name=~\"^.+\"}[10m])) by (container_name)","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"{{container_name}} -- all pools","refId":"A"},{"expr":"sum(label_replace( rate(container_cpu_usage_seconds_total{container_name!=\"POD\", node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\"}[10m])\n ,\"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\")\n ) by (container_name, nodepool)","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"{{container_name}} -- {{nodepool}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container actual CPU utilisation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":2,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"CPU Container Actual Usage","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":4},"id":40,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"Percentage of the actual used memory summed on all nodes from the same pool","fill":1,"fillGradient":0,"gridPos":{"h":12,"w":24,"x":0,"y":5},"id":42,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(\n    label_replace( container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\"}, \n    \"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\"))  \nby (nodepool)\n  * 100\n/\nsum(  label_replace(  kube_node_status_allocatable_memory_bytes{},\"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\")   ) \nby (nodepool)","format":"time_series","intervalFactor":1,"legendFormat":"{{nodepool}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Node Pool Saturation","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Memory Node Pool Saturation","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":5},"id":20,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":1,"fillGradient":0,"gridPos":{"h":10,"w":24,"x":0,"y":6},"id":10,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":true,"min":false,"rightSide":true,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(\n    label_replace( container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\"}, \n    \"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\"))  \nby (node,nodepool)\n  * 100\n/\nsum(  label_replace(kube_node_status_allocatable_memory_bytes{},\"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\")   ) \nby (node, nodepool)","format":"time_series","hide":false,"intervalFactor":5,"legendFormat":"{{node}} -- {{nodepool}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Nodes Memory Saturation","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":"100","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Memory Node Saturation","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":6},"id":22,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"fillGradient":0,"gridPos":{"h":11,"w":24,"x":0,"y":7},"id":16,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":true,"min":false,"rightSide":true,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(\n  label_replace(  container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", node=~\"^($nodepool)-[a-z0-9]*-[a-z0-9]*\"}, \n                  \"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\")\n) by (container_name, nodepool) \n   * 100\n/\nsum(\n  label_replace(  \n    label_replace( kube_pod_container_resource_requests_memory_bytes{},\n                  \"container_name\", \"$1\", \"container\", \"(.*)\") , \n    \"nodepool\", \"$1\", \"node\", \"(.*)-[a-z0-9]*-[a-z0-9]*\")\n) by (container_name, nodepool)","format":"time_series","hide":false,"instant":false,"intervalFactor":1,"legendFormat":"{{container_name}}  -- {{nodepool}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Container Requested Saturation ON Node Pool","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Memory Container Requested Saturation ON Node Pool","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":7},"id":12,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":1,"fillGradient":0,"gridPos":{"h":12,"w":24,"x":0,"y":8},"id":14,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\"}) by (container_name)","format":"time_series","intervalFactor":1,"legendFormat":"{{container_name}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container Actual Memory Usage","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Memory Container Actual Usage","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":8},"id":8,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"fillGradient":0,"gridPos":{"h":12,"w":24,"x":0,"y":9},"id":6,"interval":"5m","legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(kube_pod_container_info{}) by (container)","format":"time_series","intervalFactor":1,"legendFormat":"{{container}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"POD Count","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"POD Count","type":"row"}],"refresh":false,"schemaVersion":20,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"prometheus","definition":"label_values(kube_node_labels, node) ","hide":0,"includeAll":true,"label":"nodepool","multi":true,"name":"nodepool","options":[],"query":"label_values(kube_node_labels, node) ","refresh":2,"regex":"(.*)-[a-z0-9]*-[a-z0-9]*","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Resource Lifecycle Cluster","uid":"UpujMPGWz","version":12}
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: resource-lifecycle-deployments
      namespace: monitoring
    data:
      resource-lifecycle-deployments.json: |-
        {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":12,"iteration":1582019940890,"links":[],"panels":[{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":38,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","description":"Deviation:  % of the actual usage compared to the requested value \n\nAVERAGE: On Selected TIME WINDOW. Actual average usage in m. This value changes when time window is changed.\n\nREQUESTED:   The value present in deployment as m resources:   requests:  cpu: (value)m","fill":1,"fillGradient":0,"gridPos":{"h":11,"w":24,"x":0,"y":1},"id":42,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/REQUESTED/","lines":false},{"alias":"/ACTUAL/","lines":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(rate(container_cpu_usage_seconds_total{container_name!=\"POD\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\" , container_name=~\"$container\"}[1m])\n) by (container_name) * 100 \n/\navg(\n  label_join(kube_pod_container_resource_requests_cpu_cores{ namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"},\n  \"container_name\", \"\", \"container\")\n) by (container_name)\n-100","format":"time_series","hide":false,"interval":"","intervalFactor":3,"legendFormat":"Deviation ---- {{container_name}} ---------------- %","refId":"A"},{"expr":"avg(rate(container_cpu_usage_seconds_total{container_name!=\"POD\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\" , container_name=~\"$container\"}[1m])\n) by (container_name) * 1000","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"ACTUAL --- {{container_name}}  (value)m","refId":"B"},{"expr":"avg(kube_pod_container_resource_requests_cpu_cores{ namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"}\n) by (container) * 1000","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"REQUESTED {{container}} (value)m","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[{"colorMode":"background6","fill":true,"fillColor":"rgba(234, 112, 112, 0.12)","fromDayOfWeek":1,"line":false,"lineColor":"rgba(237, 46, 24, 0.60)","op":"time"},{"colorMode":"background6","fill":true,"fillColor":"rgba(234, 112, 112, 0.12)","fromDayOfWeek":3,"line":false,"lineColor":"rgba(237, 46, 24, 0.60)","op":"time"},{"colorMode":"background6","fill":true,"fillColor":"rgba(234, 112, 112, 0.12)","fromDayOfWeek":5,"line":false,"lineColor":"rgba(237, 46, 24, 0.60)","op":"time"}],"timeShift":null,"title":"CPU Deployment per Container Saturation","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"none","label":null,"logBase":1,"max":"150","min":"-100","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":10}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"Deviation:  % of the actual usage compared to the requested value \n\nAVERAGE: On Selected TIME WINDOW. Actual average usage in Mi. This value changes when time window is changed.\n\nREQUESTED:   The value present in deployment as Mi resources:   requests:  memory: (value)Mi \nWARNING, for JOBS the avg is not the value in the deployment. Please consult the value in the graph","fill":1,"fillGradient":0,"gridPos":{"h":11,"w":24,"x":0,"y":12},"id":40,"legend":{"alignAsTable":true,"avg":true,"current":false,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"url":"/"}],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/REQUESTED/","lines":false},{"alias":"/ACTUAL/","lines":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"avg(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container_name=~\"$container\"}\n) by (container_name) * 100 \n/\navg(label_join(kube_pod_container_resource_requests_memory_bytes{namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"},\n   \"container_name\", \"\", \"container\")\n) by (container_name) - 100","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"Deviation ---- {{container_name}} ---------------- %","refId":"A"},{"expr":"avg(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container_name=~\"$container\"}\n/ 1024 / 1024 ) by (container_name)","format":"time_series","instant":false,"intervalFactor":1,"legendFormat":"ACTUAL --- {{container_name}}  (value)Mi","refId":"B"},{"expr":"avg(label_join(kube_pod_container_resource_requests_memory_bytes{namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"},\n   \"container_name\", \"\", \"container\")\n/ 1024 / 1024) by (container_name) ","format":"time_series","intervalFactor":1,"legendFormat":"REQUESTED {{container_name}} (value)Mi","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[{"colorMode":"background6","fill":true,"fillColor":"rgba(234, 112, 112, 0.12)","fromDayOfWeek":1,"line":false,"lineColor":"rgba(237, 46, 24, 0.60)","op":"time"},{"colorMode":"background6","fill":true,"fillColor":"rgba(234, 112, 112, 0.12)","fromDayOfWeek":3,"line":false,"lineColor":"rgba(237, 46, 24, 0.60)","op":"time"},{"colorMode":"background6","fill":true,"fillColor":"rgba(234, 112, 112, 0.12)","fromDayOfWeek":5,"line":false,"lineColor":"rgba(237, 46, 24, 0.60)","op":"time"}],"timeShift":null,"title":"Memory Deployment per Container Saturation","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":null,"logBase":1,"max":"+150","min":"-100","show":true},{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","decimals":3,"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":23},"id":58,"legend":{"alignAsTable":true,"avg":true,"current":false,"max":true,"min":false,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment.*\", container_name=~\"$container\"}\n/ 1024 / 1024","format":"time_series","intervalFactor":1,"legendFormat":"{{pod_name}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Container Actual memory Utilisation ( Expensive query )","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":3,"format":"decmbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Deployment Deviation CPU & MEM","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":1},"id":14,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":2,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":2},"id":50,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":true,"targets":[{"expr":"sum(label_replace( kube_pod_status_phase{namespace=~\"($namespace).*\", pod=~\"($deployment-[a-z0-9]*-[a-z0-9]*$|$deployment-[0-9]*$).*\"},     \"rs\", \"$1\", \"pod\", \".*-(.*)-[a-z0-9]{5}$\")) by (rs)","format":"time_series","intervalFactor":1,"legendFormat":"$deployment-{{rs}}-*","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Deployment Replicaset hash","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"locale","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"kubectl get endpoints $deployment","fill":1,"fillGradient":0,"gridPos":{"h":6,"w":24,"x":0,"y":9},"id":46,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":true,"targets":[{"expr":"kube_endpoint_address_available{namespace=~\"($namespace).*\", endpoint=~\"$deployment.*\"}","format":"time_series","intervalFactor":1,"legendFormat":"LB -{{endpoint}} {{instance}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"ENDPOINTS Count - Selected by SERVICE label=$deployment  LB","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"locale","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Deployment Rollover Info","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":2},"id":48,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"fillGradient":0,"gridPos":{"h":6,"w":24,"x":0,"y":3},"id":10,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(kube_pod_status_phase{namespace=~\"($namespace).*\", pod=~\"($deployment-[a-z0-9]*-[a-z0-9]*$|$deployment-[0-9]*$).*\"})","format":"time_series","intervalFactor":1,"legendFormat":"PODS","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Actual POD Count","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"locale","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"If Container in pods have different start time, they can be present here as not overlapping line","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":9},"id":44,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"count(container_cpu_usage_seconds_total{container_name!=\"POD\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\"}) by (container_name)","format":"time_series","intervalFactor":1,"legendFormat":"{{container_name}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"POD Container Delay ( startup / shutdown )","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"locale","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Deployment PODs Availability","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":3},"id":16,"panels":[{"aliasColors":{"REQUESTED":"blue","USED":"yellow"},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"fillGradient":0,"gridPos":{"h":9,"w":24,"x":0,"y":4},"id":2,"interval":"","legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(container_cpu_usage_seconds_total{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\"}[1m])) * 1000","format":"time_series","intervalFactor":1,"legendFormat":"USED","refId":"A"},{"expr":"sum(kube_pod_container_resource_requests_cpu_cores{namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\"}) * 1000","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"REQUESTED","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU per Deployment sum of all pods and containers","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":"m","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"CPU Deployment","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":4},"id":24,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","fill":0,"fillGradient":0,"gridPos":{"h":9,"w":24,"x":0,"y":5},"id":12,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(container_cpu_usage_seconds_total{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container_name=~\"$container\"}[1m])) by (container_name) * 1000","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"USED ---------- {{container_name}}","refId":"A"},{"expr":"sum(kube_pod_container_resource_requests_cpu_cores{ namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"}) by (container) * 1000","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"REQUESTED {{container}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU per Container","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":"m","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"CPU Deployment per Container","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":5},"id":28,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"REQUESTED - The value added in the deployment .yaml for that container. Reflects deployment changes\n\n\n\nACTUAL - Average usage of all running instances of that container. THIS hides anomalies of single containers.\n\n\nRECOMMENDED - Actual usage -10% average on 6 hours. IT is not a static value as that will hide the peaks and lows. This is present as a hint of the expected value","fill":0,"fillGradient":0,"gridPos":{"h":11,"w":24,"x":0,"y":6},"id":30,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(container_cpu_usage_seconds_total{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\" , container_name=~\"$container\"}[6h]) * 0.90) by (container_name) * 1000 \n/\nsum(label_replace(  kube_pod_container_status_running{ namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"} ,\"container_name\", \"$1\", \"container\", \"(.*)\")) by (container_name)","format":"time_series","hide":false,"interval":"6h","intervalFactor":1,"legendFormat":"RECOMMENDED {{container_name}}   ---  requests: cpu: (value)m","refId":"D"},{"expr":"avg(kube_pod_container_resource_requests{namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", resource=\"cpu\", container=~\"$container\"}) by (container) * 1000 ","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"REQUESTED -- {{container}}","refId":"B"},{"expr":"(sum(rate(container_cpu_usage_seconds_total{container_name!=\"POD\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container_name=~\"$container\"}[3h])) by (container_name)  ) \n     * 1000 \n/\nsum(\n  label_join(kube_pod_container_status_running{container_name!=\"POD\", namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"}, \n             \"container_name\", \"\", \"container\")\n) by (container_name)","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"ACTUAL {{container_name}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Recommended Requested CPU per Container ( 6h average -10% )","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"none","label":"m","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"CPU Deployment per Container RECOMMENDED","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":6},"id":22,"panels":[{"aliasColors":{"Requested":"blue","USED":"yellow","Used":"yellow"},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"","fill":1,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":7},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\"})","format":"time_series","intervalFactor":1,"legendFormat":"Used","refId":"A"},{"expr":"sum(kube_pod_container_resource_requests_memory_bytes{namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\"})","format":"time_series","intervalFactor":1,"legendFormat":"Requested","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"POD Memory utilisation sum of all pods and containers","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"This shows that the kubernetes scheduler spawned the pods across multiple nodes or tainting selection forced the placement of too many on one node","fill":1,"fillGradient":0,"gridPos":{"h":9,"w":24,"x":0,"y":15},"id":8,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"($deployment-[a-z0-9]*-[a-z0-9]*$|$deployment-[0-9]*$).*\"}) by (node)","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"{{node}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"MEMORY NODE Distribution","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Memory Deployment","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":7},"id":36,"panels":[{"aliasColors":{"REQUESTED container":"blue","USED ---------- container_name":"yellow"},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"The values are a sum of all the pods for that deployment. ","fill":1,"fillGradient":0,"gridPos":{"h":10,"w":24,"x":0,"y":8},"id":26,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container_name=~\"$container\"}) by (container_name)","format":"time_series","intervalFactor":1,"legendFormat":"USED ---------- {{container_name}}","refId":"A"},{"expr":"sum(kube_pod_container_resource_requests_memory_bytes{ namespace=~\"($namespace).*\" ,pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"}) by (container)","format":"time_series","intervalFactor":1,"legendFormat":"REQUESTED {{container}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory per Container sum of all pods","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Memory Deployment per Container","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":8},"id":34,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"prometheus","description":"REQUESTED - The value added in the deployment .yaml for that container. Reflects deployment changes\n\n\n\nACTUAL - Average usage of all running instances of that container. THIS hides anomalies of single containers.\n\n\nRECOMMENDED - Actual usage +25% average on 6 hours. IT is not a static value as that will hide the peaks and lows. This is present as a hint of the expected value","fill":1,"fillGradient":0,"gridPos":{"h":10,"w":24,"x":0,"y":9},"id":32,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"paceLength":10,"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"($namespace).*\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container_name=~\"$container\"}\n) by (container_name) \n  * 1.25\n  / 1048576\n/\nsum(\n  label_replace(kube_pod_container_status_running{ namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\"} ,\"container_name\", \"$1\", \"container\", \"(.*)\")\n) by (container_name)","format":"time_series","hide":false,"interval":"6h","intervalFactor":1,"legendFormat":"RECOMMENDED {{container_name}}   ---  requests:  memory: (value)Mi","refId":"A"},{"expr":"avg(kube_pod_container_resource_requests_memory_bytes{ namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container=~\"$container\"}) by (container) \n/ 1048576","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"REQUESTED ------ {{container}}","refId":"B"},{"expr":"sum(container_memory_working_set_bytes{container_name!=\"POD\",container_name=~\"^.+\", namespace=~\"$namespace\", pod_name=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\", container_name=~\"($container).*\"}) by (container_name)\n  / 1048576\n/\nsum(label_replace(  kube_pod_container_status_running{ namespace=~\"($namespace).*\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\"} ,\"container_name\", \"$1\", \"container\", \"(.*)\")) by (container_name)","format":"time_series","hide":false,"intervalFactor":1,"legendFormat":"ACUTAL ------------- {{container_name}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Deployment per Container RECOMMENDED (6h average usage + 25%)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"none","label":"Mi","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Memory Deployment per Container RECOMMENDED","type":"row"}],"refresh":false,"schemaVersion":20,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"selected":true,"text":"All","value":"$__all"},"datasource":"prometheus","definition":"label_values(namespace)","hide":0,"includeAll":true,"label":"namespace","multi":false,"name":"namespace","options":[],"query":"label_values(namespace)","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":"flight-club-radar","value":"flight-club-radar"},"datasource":"prometheus","definition":"label_values(kube_pod_container_info{namespace=~\"$namespace\"}, pod) ","hide":0,"includeAll":false,"label":"deployment","multi":false,"name":"deployment","options":[],"query":"label_values(kube_pod_container_info{namespace=~\"$namespace\"}, pod) ","refresh":2,"regex":"(.*)-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"All","value":["$__all"]},"datasource":"prometheus","definition":"label_values(kube_pod_container_status_running{namespace=~\"$namespace\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\" }, container) ","hide":0,"includeAll":true,"label":"container","multi":true,"name":"container","options":[],"query":"label_values(kube_pod_container_status_running{namespace=~\"$namespace\", pod=~\"$deployment-([a-z0-9]{5,10}-[a-z0-9]{5}$|[0-9]{1}$)$\" }, container) ","refresh":2,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Resource Lifecycle Deployments","uid":"wG8ys-GWk","version":13}
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: thanos-sidecar
      namespace: monitoring
    data:
      thanos-sidecar.json: |-
        {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":47,"iteration":1582801036767,"links":[],"panels":[{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":22,"panels":[],"repeat":null,"title":"Thanos Sidecar","type":"row"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"thanos","format":"dateTimeFromNow","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":12,"x":0,"y":1},"id":29,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"maxPerRow":12,"nullPointMode":"connected","nullText":null,"options":{},"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":null,"text":"N/A","to":null}],"repeat":null,"repeatDirection":"h","sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"min(thanos_objstore_bucket_last_successful_upload_time{job=\"$job\"})*1000","format":"time_series","intervalFactor":1,"refId":"A"}],"thresholds":"","title":"Last Upload time","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":null}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"thanos","format":"dateTimeFromNow","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":3,"w":12,"x":12,"y":1},"id":30,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"maxPerRow":12,"nullPointMode":"connected","nullText":null,"options":{},"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":null,"text":"N/A","to":null}],"repeatDirection":"h","sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"tableColumn":"","targets":[{"expr":"min(thanos_sidecar_last_heartbeat_success_time_seconds{job=\"$job\"})*1000","format":"time_series","intervalFactor":1,"refId":"A"}],"thresholds":"","title":"Last Heartbeat time","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":null}],"valueName":"current"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":4},"id":31,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(grpc_server_handled_total{job=\"$job\"}[$interval])) by (grpc_code, grpc_method, pod)","format":"time_series","intervalFactor":1,"legendFormat":"{{grpc_code}} {{grpc_method}}  {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query RPS [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":11},"id":32,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(grpc_server_handling_seconds_bucket{job=\"$job\"}[$interval])) by (grpc_method, le, pod))","format":"time_series","intervalFactor":1,"legendFormat":"99.99 {{grpc_method}} {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Response Time Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":18},"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(thanos_objstore_bucket_operations_total{job=\"$job\"}[$interval])) by (pod, operation)","format":"time_series","intervalFactor":1,"legendFormat":"{{operation}} {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Bucket Operations/s [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":18},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(thanos_objstore_bucket_operation_failures_total{job=\"$job\"}[$interval])) by (operation,pod)","format":"time_series","intervalFactor":1,"legendFormat":"{{operation}} {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Bucket Operation Failures/s [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":25},"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(thanos_objstore_bucket_operation_duration_seconds_bucket{job=\"$job\"}[$interval])) by (pod,le))","format":"time_series","instant":false,"intervalFactor":2,"legendFormat":"99.99 bucket ops {{pod}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Bucket Operation Time Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":33},"id":25,"panels":[],"repeat":null,"title":"Ops","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":34},"id":13,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_memstats_heap_alloc_bytes{job=\"$job\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Used","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":34},"id":19,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":null,"options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_goroutines{job=\"$job\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Goroutines","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":41},"id":18,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_gc_duration_seconds{job=\"$job\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{quantile}} {{pod}}","refId":"A","step":2},{"expr":"","format":"time_series","intervalFactor":1,"refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GC Time Quantiles","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"30s","revision":null,"schemaVersion":20,"style":"dark","tags":["thanos"],"templating":{"list":[{"auto":false,"auto_count":30,"auto_min":"10s","current":{"text":"1m","value":"1m"},"hide":0,"label":null,"name":"interval","options":[{"selected":true,"text":"1m","value":"1m"},{"selected":false,"text":"10m","value":"10m"},{"selected":false,"text":"30m","value":"30m"},{"selected":false,"text":"1h","value":"1h"},{"selected":false,"text":"6h","value":"6h"},{"selected":false,"text":"12h","value":"12h"},{"selected":false,"text":"1d","value":"1d"},{"selected":false,"text":"7d","value":"7d"},{"selected":false,"text":"14d","value":"14d"},{"selected":false,"text":"30d","value":"30d"}],"query":"1m,10m,30m,1h,6h,12h,1d,7d,14d,30d","refresh":2,"skipUrlSync":false,"type":"interval"},{"allValue":null,"current":{"tags":[],"text":"thanos-sidecar","value":"prometheus-sidecar"},"datasource":"thanos","definition":"label_values(thanos_build_info, job)","hide":0,"includeAll":false,"label":"job","multi":false,"name":"job","options":[{"selected":true,"text":"prometheus-sidecar","value":"prometheus-sidecar"}],"query":"label_values(thanos_build_info, job)","refresh":0,"regex":"/prometheus-sidecar*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"Thanos Sidecar","uid":"IOteEKHik","version":4}
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: thanos-store
      namespace: monitoring
    data:
      thanos-store.json: |-
        {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":45,"iteration":1582801521181,"links":[],"panels":[{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":22,"panels":[],"repeat":null,"title":"thanos-store","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":1},"id":28,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(grpc_server_handled_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (grpc_code, grpc_method, pod)","format":"time_series","intervalFactor":1,"legendFormat":"{{grpc_code}} {{grpc_method}}  {{pod}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query RPS [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":8},"id":29,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(grpc_server_handling_seconds_bucket{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (grpc_method, le, pod))","format":"time_series","intervalFactor":1,"legendFormat":"{{grpc_method}} {{pod}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Response Time 99.99 Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":15},"id":32,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(thanos_bucket_store_sent_chunk_size_bytes_bucket{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (le, pod))","format":"time_series","intervalFactor":1,"legendFormat":"{{pod}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Response Size 99.99 Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":22},"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(thanos_objstore_bucket_operations_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod, operation)","format":"time_series","intervalFactor":1,"legendFormat":"bucket {{operation}} {{pod}}","refId":"A"},{"expr":"sum(rate(thanos_bucket_store_block_drops_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"block drops {{pod}}","refId":"B"},{"expr":"sum(rate(thanos_bucket_store_block_loads_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"block loads {{pod}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Operations/s [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":22},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(thanos_objstore_bucket_operation_failures_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (operation,pod)","format":"time_series","intervalFactor":1,"legendFormat":"bucket {{operation}} {{pod}}","refId":"A"},{"expr":"sum(rate(thanos_bucket_store_block_drop_failures_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"block drop {{pod}}","refId":"B"},{"expr":"sum(rate(thanos_bucket_store_block_load_failures_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"block load {{pod}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Operation Failures/s [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":29},"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(thanos_objstore_bucket_operation_duration_seconds_bucket{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod,le, operation))","format":"time_series","instant":false,"intervalFactor":2,"legendFormat":"99.99 bucket {{operation}} {{pod}}","refId":"C"},{"expr":"histogram_quantile(0.9999, sum(rate(thanos_bucket_store_series_get_all_duration_seconds_bucket{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod,le))","format":"time_series","intervalFactor":1,"legendFormat":"99.99 get all {{pod}}","refId":"A"},{"expr":"histogram_quantile(0.9999, sum(rate(thanos_bucket_store_series_merge_duration_seconds_bucket{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod,le))","format":"time_series","intervalFactor":1,"legendFormat":"99.99 merge {{pod}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Operation Time Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":29},"id":30,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(thanos_store_index_cache_items_added_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod,item_type)","format":"time_series","intervalFactor":1,"legendFormat":"added {{item_type}} {{pod}}","refId":"D"},{"expr":"sum(rate(thanos_store_index_cache_items_evicted_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod,item_type)","format":"time_series","intervalFactor":1,"legendFormat":"evicted {{item_type}} {{pod}}","refId":"E"},{"expr":"sum(rate(thanos_store_index_cache_requests_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod,item_type)","format":"time_series","intervalFactor":1,"legendFormat":"requests {{item_type}} {{pod}}","refId":"F"},{"expr":"sum(rate(thanos_store_index_cache_hits_total{$labelselector=\"$labelvalue\", pod=\"$pod\"}[$interval])) by (pod, item_type)","format":"time_series","intervalFactor":1,"legendFormat":"hits {{item_type}} {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Cache Ops/s [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":36},"id":25,"panels":[],"repeat":null,"title":"Ops","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":37},"id":13,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_memstats_heap_alloc_bytes{$labelselector=\"$labelvalue\", pod=\"$pod\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}} ","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Used","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":37},"id":19,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":null,"options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_goroutines{$labelselector=\"$labelvalue\", pod=\"$pod\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Goroutines","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":44},"id":18,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_gc_duration_seconds{$labelselector=\"$labelvalue\", quantile=\"1\", pod=\"$pod\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GC Time Quantiles","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"5m","revision":null,"schemaVersion":20,"style":"dark","tags":["thanos"],"templating":{"list":[{"auto":false,"auto_count":30,"auto_min":"10s","current":{"text":"1m","value":"1m"},"hide":0,"label":null,"name":"interval","options":[{"selected":true,"text":"1m","value":"1m"},{"selected":false,"text":"10m","value":"10m"},{"selected":false,"text":"30m","value":"30m"},{"selected":false,"text":"1h","value":"1h"},{"selected":false,"text":"6h","value":"6h"},{"selected":false,"text":"12h","value":"12h"},{"selected":false,"text":"1d","value":"1d"},{"selected":false,"text":"7d","value":"7d"},{"selected":false,"text":"14d","value":"14d"},{"selected":false,"text":"30d","value":"30d"}],"query":"1m,10m,30m,1h,6h,12h,1d,7d,14d,30d","refresh":2,"skipUrlSync":false,"type":"interval"},{"current":{"text":"service","value":"service"},"hide":2,"label":null,"name":"labelselector","options":[{"text":"service","value":"service"}],"query":"service","skipUrlSync":false,"type":"constant"},{"current":{"text":"thanos-store-gateway","value":"thanos-store-gateway"},"hide":2,"label":null,"name":"labelvalue","options":[{"text":"thanos-store-gateway","value":"thanos-store-gateway"}],"query":"thanos-store-gateway","skipUrlSync":false,"type":"constant"},{"allValue":null,"current":{"text":"thanos-store-gateway","value":"thanos-store-gateway"},"datasource":"thanos","definition":"label_values(thanos_build_info, service)","hide":0,"includeAll":false,"label":null,"multi":false,"name":"service","options":[{"selected":true,"text":"thanos-store-gateway","value":"thanos-store-gateway"}],"query":"label_values(thanos_build_info, service)","refresh":0,"regex":"/thanos-store-gateway*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"thanos-store-0","value":"thanos-store-0"},"datasource":"thanos","definition":"label_values(thanos_build_info, pod) ","hide":0,"includeAll":false,"label":null,"multi":false,"name":"pod","options":[{"selected":true,"text":"thanos-store-0","value":"thanos-store-0"}],"query":"label_values(thanos_build_info, pod) ","refresh":0,"regex":"/thanos-store-*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"Thanos Store","uid":"KqPVKRIiz","version":6}
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: thanos-query 
      namespace: monitoring
    data:
      thanos-query.json: |-
        {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":41,"iteration":1582801417337,"links":[],"panels":[{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":22,"panels":[],"repeat":null,"title":"Thanos Query","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":1},"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(grpc_client_handled_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod, grpc_code, grpc_method)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{grpc_code}} {{grpc_method}} {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Request RPS","tooltip":{"msResolution":false,"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"reqps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":8},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(grpc_client_handling_seconds_bucket{$labelselector=\"$labelvalue\"}[$interval])) by (grpc_method,pod, le))","format":"time_series","intervalFactor":1,"legendFormat":"99.99 {{grpc_method}} {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Response Time Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":15},"id":32,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(http_request_duration_seconds_bucket{$labelselector=\"$labelvalue\",handler=\"query\"}[$interval])) by (pod, le))","format":"time_series","intervalFactor":1,"legendFormat":"instant_query {{pod}}","refId":"A"},{"expr":"histogram_quantile(0.9999, sum(rate(http_request_duration_seconds_bucket{$labelselector=\"$labelvalue\",handler=\"query_range\"}[$interval])) by (pod, le))","format":"time_series","intervalFactor":1,"legendFormat":"range_query {{pod}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Thanos Query 99.99 Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":22},"id":31,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":null,"options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"thanos_engine_query_duration_seconds{$labelselector=\"$labelvalue\",quantile=\"0.99\"}  ","format":"time_series","intervalFactor":1,"legendFormat":" {{slice}} {{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Prometheus Query 99 Quantile","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","fill":1,"gridPos":{"h":10,"w":24,"x":0,"y":29},"id":29,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":null,"options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"prometheus_engine_queries{$labelselector=\"$labelvalue\"}","format":"time_series","instant":false,"intervalFactor":1,"legendFormat":"{{pod}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Prometheus Queries/s","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":39},"id":25,"panels":[],"repeat":null,"title":"Ops","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"gridPos":{"h":7,"w":12,"x":0,"y":40},"id":13,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_memstats_heap_alloc_bytes{$labelselector=\"$labelvalue\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Used","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","fill":1,"gridPos":{"h":7,"w":12,"x":12,"y":40},"id":19,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":null,"options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_goroutines{$labelselector=\"$labelvalue\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Goroutines","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"gridPos":{"h":7,"w":24,"x":0,"y":47},"id":18,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_gc_duration_seconds{$labelselector=\"$labelvalue\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{quantile}} {{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GC Time Quantiles","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"30s","revision":null,"schemaVersion":20,"style":"dark","tags":["thanos"],"templating":{"list":[{"auto":false,"auto_count":30,"auto_min":"10s","current":{"text":"1m","value":"1m"},"hide":0,"label":null,"name":"interval","options":[{"selected":true,"text":"1m","value":"1m"},{"selected":false,"text":"10m","value":"10m"},{"selected":false,"text":"30m","value":"30m"},{"selected":false,"text":"1h","value":"1h"},{"selected":false,"text":"6h","value":"6h"},{"selected":false,"text":"12h","value":"12h"},{"selected":false,"text":"1d","value":"1d"},{"selected":false,"text":"7d","value":"7d"},{"selected":false,"text":"14d","value":"14d"},{"selected":false,"text":"30d","value":"30d"}],"query":"1m,10m,30m,1h,6h,12h,1d,7d,14d,30d","refresh":2,"skipUrlSync":false,"type":"interval"},{"allValue":"","current":{"text":"All","value":"$__all"},"datasource":"thanos","definition":"label_values(thanos_build_info, pod)","hide":0,"includeAll":true,"label":"pod","multi":false,"name":"pod","options":[],"query":"label_values(thanos_build_info, pod)","refresh":1,"regex":"/thanos-query-*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"current":{"text":"thanos-query","value":"thanos-query"},"hide":2,"label":null,"name":"labelvalue","options":[{"text":"thanos-query","value":"thanos-query"}],"query":"thanos-query","skipUrlSync":false,"type":"constant"},{"current":{"text":"service","value":"service"},"hide":2,"label":null,"name":"labelselector","options":[{"text":"service","value":"service"}],"query":"service","skipUrlSync":false,"type":"constant"}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"Thanos Query","uid":"opwl5gSiz","version":2}
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: thanos-compactor
      namespace: monitoring
    data:
      thanos-compactor.json: |-
        {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":40,"iteration":1582801679182,"links":[],"panels":[{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":22,"panels":[],"repeat":null,"title":"Thanos Compact","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":1},"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(thanos_tsdb_compactions_total{$labelselector=\"$labelvalue\",kubernetes_namespace=~\"$namespace\"}[$interval])) by (kubernetes_namespace)","format":"time_series","intervalFactor":1,"legendFormat":"compaction {{pod}}","refId":"B"},{"expr":"sum(rate(thanos_objstore_bucket_operations_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"bucket ops {{pod}}","refId":"A"},{"expr":"sum(rate(thanos_compact_garbage_collection_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"gc ops  {{pod}}","refId":"C"},{"expr":"sum(rate(thanos_compact_group_compactions_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"group compact  {{pod}}","refId":"D"},{"expr":"sum(rate(thanos_compact_sync_meta_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"sync metas  {{pod}}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Operations/s [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":1},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"avg","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(prometheus_tsdb_compactions_failed_total{$labelselector=\"$labelvalue\",kubernetes_namespace=~\"$namespace\"}[$interval])) by (kubernetes_namespace)","format":"time_series","intervalFactor":1,"legendFormat":"compaction {{pod}}","refId":"B"},{"expr":"sum(rate(thanos_objstore_bucket_operation_failures_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"bucket ops {{pod}}","refId":"A"},{"expr":"sum(rate(thanos_compact_garbage_collection_failures_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"gc ops  {{pod}}","refId":"C"},{"expr":"sum(rate(thanos_compact_group_compactions_failures_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"group compact  {{pod}}","refId":"D"},{"expr":"sum(rate(thanos_compact_sync_meta_failures_total{$labelselector=\"$labelvalue\"}[$interval])) by (pod)","format":"time_series","intervalFactor":1,"legendFormat":"sync metas  {{pod}}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Operation Failures/s [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":8},"id":6,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.9999, sum(rate(thanos_compact_garbage_collection_duration_seconds_bucket{$labelselector=\"$labelvalue\"}[$interval])) by (pod,le))","format":"time_series","instant":false,"intervalFactor":2,"legendFormat":"99.99 gc {{pod}}","refId":"A","step":2},{"expr":"histogram_quantile(0.9999, sum(rate(thanos_compact_sync_meta_duration_seconds_bucket{$labelselector=\"$labelvalue\"}[$interval])) by (pod,le))","format":"time_series","intervalFactor":2,"legendFormat":"99.99 sync meta  {{pod}}","refId":"B"},{"expr":"histogram_quantile(0.9999, sum(rate(thanos_objstore_bucket_operation_duration_seconds_bucket{$labelselector=\"$labelvalue\"}[$interval])) by (pod,le))","format":"time_series","instant":false,"intervalFactor":2,"legendFormat":"99.99 bucket ops {{pod}}","refId":"C"},{"expr":"histogram_quantile(0.9999, sum(rate(prometheus_tsdb_compaction_duration_seconds_bucket{$labelselector=\"$labelvalue\"}[$interval])) by (pod,le))","format":"time_series","intervalFactor":1,"legendFormat":"99.99 compact {{pod}}","refId":"D"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Operation Time Quantile [$interval]","tooltip":{"msResolution":false,"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":16},"id":25,"panels":[],"repeat":null,"title":"Ops","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":17},"id":13,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_working_set_bytes{pod_name=\"thanos-compactor-temp-0\"})","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}} ","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Used","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":17},"id":19,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":null,"options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_goroutines{$labelselector=\"$labelvalue\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Goroutines","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"thanos","editable":true,"error":false,"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":24,"x":0,"y":24},"id":18,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"dataLinks":[]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"go_gc_duration_seconds{$labelselector=\"$labelvalue\", quantile=\"1\"}","format":"time_series","intervalFactor":2,"legendFormat":"{{pod}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GC Time Quantiles","tooltip":{"msResolution":false,"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"30s","revision":null,"schemaVersion":20,"style":"dark","tags":["thanos"],"templating":{"list":[{"auto":false,"auto_count":30,"auto_min":"10s","current":{"text":"1m","value":"1m"},"hide":0,"label":null,"name":"interval","options":[{"selected":true,"text":"1m","value":"1m"},{"selected":false,"text":"10m","value":"10m"},{"selected":false,"text":"30m","value":"30m"},{"selected":false,"text":"1h","value":"1h"},{"selected":false,"text":"6h","value":"6h"},{"selected":false,"text":"12h","value":"12h"},{"selected":false,"text":"1d","value":"1d"},{"selected":false,"text":"7d","value":"7d"},{"selected":false,"text":"14d","value":"14d"},{"selected":false,"text":"30d","value":"30d"}],"query":"1m,10m,30m,1h,6h,12h,1d,7d,14d,30d","refresh":2,"skipUrlSync":false,"type":"interval"},{"current":{"text":"service","value":"service"},"hide":2,"label":null,"name":"labelselector","options":[{"text":"service","value":"service"}],"query":"service","skipUrlSync":false,"type":"constant"},{"current":{"text":"thanos-compactor","value":"thanos-compactor"},"hide":2,"label":null,"name":"labelvalue","options":[{"text":"thanos-compactor","value":"thanos-compactor"}],"query":"thanos-compactor","skipUrlSync":false,"type":"constant"},{"allValue":null,"current":{"text":"All","value":"$__all"},"datasource":"thanos","definition":"label_values(thanos_build_info, pod)","hide":0,"includeAll":true,"label":"pod","multi":false,"name":"pod","options":[],"query":"label_values(thanos_build_info, pod)","refresh":2,"regex":"/thanos-compactor-*/","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"Thanos Compactor","uid":"s48S7j4ik","version":4}

